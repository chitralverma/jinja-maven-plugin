<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/examples.md at 2021-04-13
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Jinja Maven Plugin &#x2013; Examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/chitralverma/jinja-maven-plugin/fork">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>Jinja Maven Plugin</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-04-13<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="generate-mojo.html" title="Goals"><span class="none"></span>Goals</a></li>
    <li><a href="https://www.github.com/chitralverma/jinja-maven-plugin/" class="externalLink" target="_blank" title="Github"><span class="none"></span>Github</a></li>
    <li><a href="licenses.html" title="License"><span class="none"></span>License</a></li>
   <li class="nav-header">Guides</li>
    <li><a href="usage.html#Installation" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="configuration.html" title="Configuration"><span class="none"></span>Configuration</a></li>
    <li><a href="usage.html#Usage" title="Usage"><span class="none"></span>Usage</a></li>
   <li class="nav-header">Examples</li>
    <li><a href="examples.html#Simple_Substitution" title="Simple Substitution"><span class="none"></span>Simple Substitution</a></li>
    <li><a href="examples.html#Complex_Substitutions_and_Statements" title="Complex Case"><span class="none"></span>Complex Case</a></li>
    <li><a href="examples.html#Rendering_Profiles" title="Rendering Profiles"><span class="none"></span>Rendering Profiles</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<!--
   Copyright 2021 Chitral Verma

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<h1>Examples</h1>
<p>Maven build tool allows a lot of flexibility to end users to model their complex use cases.</p>
<p>Some specific use cases are described in the following sections. Resources for these examples can be found at <a class="externalLink" href="https://github.com/chitralverma/jinja-maven-plugin/tree/master/examples/src/main/resources">this link</a> .</p><section>
<h2><a name="Simple_Substitution"></a>Simple Substitution</h2>
<p>This example uses a single value file for substitution into the JSON template file.</p>
<ul>

<li>

<p><b>Use case:</b> This is a simple use case of direct value substitution into the template file.</p>
</li>
<li>

<p><b>Template File:</b></p>
</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;app_name&quot;: &quot;{{name}}&quot;,
  &quot;app_version&quot;: {{version}},
  &quot;env_name&quot;: &quot;{{env}}&quot;,
  &quot;db_connect&quot;: &quot;{{db}}&quot;
}
</pre></div></div>

<ul>

<li><b>Value File:</b></li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;name&quot;: &quot;SimpleApp&quot;,
  &quot;version&quot;: 1.0,
  &quot;env&quot;: &quot;uat&quot;,
  &quot;db_host&quot;: &quot;1.2.3.4&quot;,
  &quot;db_port&quot;: 9876,
  &quot;db&quot;: &quot;jdbc:mysql://{{db_host}}:{{db_port}}/&quot;
}
</pre></div></div>

<ul>

<li><b>Output File:</b></li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;app_name&quot;: &quot;SimpleApp&quot;,
  &quot;app_version&quot;: 1.0,
  &quot;env_name&quot;: &quot;uat&quot;,
  &quot;db_connect&quot;: &quot;jdbc:mysql://1.2.3.4:9876/&quot;
}
</pre></div></div>
</section><section>
<h2><a name="Complex_Substitutions_and_Statements"></a>Complex Substitutions and Statements</h2>
<p>This example uses multiple value files for direct and indirect substitutions into the YAML template file along with complex conditional statements.</p>
<p>See <a class="externalLink" href="https://jinja.palletsprojects.com/en/2.11.x/templates/#list-of-control-structures">this link</a> for more examples of Jinja Control Structures.</p>
<ul>

<li>

<p><b>Use case:</b> This is a rather complex use case, through which some of the capabilities of Jinja templating engine and the plugin are shown as mentioned below,</p>
<ul>

<li>

<p>Multilevel substitution</p>
</li>
<li>

<p>Value overriding</p>
</li>
<li>

<p>Multiple contexts</p>
</li>
<li>

<p>Control Structure support</p>
</li>
</ul>
</li>
<li>

<p><b>Template File:</b></p>
</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">server:
  ports: {{serverPorts}}
  context-path: {{contextPath}}
config:
  app:
    name: {{name}}
  task:
    scheduling:
      pool:
        size: {{poolSize}}
  datasource:
    driverClassName: {{dbDriverClass}}
    url: {{connectString}}
    username: {{dbUserName}}
    password: {{dbPassword}}
    options: {{sourceOptions}}
</pre></div></div>

<ul>

<li>

<p><b>Value Files:</b></p>
<ul>

<li>Common Properties for some sample system

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;name&quot;: &quot;ComplexApp&quot;,
  &quot;contextPath&quot;: &quot;/v1&quot;,
  &quot;poolSize&quot;: 7,
  &quot;dbDriverClass&quot;: &quot;com.mysql.jdbc.Driver&quot;,
  &quot;mysql&quot;: &quot;mysql&quot;,
  &quot;db2&quot;: &quot;db2&quot;,
  &quot;dbType&quot;: &quot;{% if 'mysql' in dbDriverClass %}mysql{% else %}db2{% endif %}&quot;,
  &quot;connectString&quot;: &quot;jdbc:{{dbType}}://{{db_host}}:{{db_port}}/&quot;,
  &quot;sourceOptions&quot;: {
    &quot;prepStmtCacheSize&quot;: 250,
    &quot;cachePrepStmts&quot;: true
  }
}
</pre></div></div>
</li>
<li>Common Properties for some sample system</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;serverPorts&quot;: [
    4000,
    4001,
    4002
  ],
  &quot;db_host&quot;: &quot;1.2.3.4&quot;,
  &quot;db_port&quot;: &quot;3306&quot;,
  &quot;dbUserName&quot;: &quot;db_user_uat&quot;,
  &quot;dbPassword&quot;: &quot;Password_uat_1234&quot;
}
</pre></div></div>
</li>
<li>

<p><b>Output File:</b></p>
</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">server:
  ports: [4000,4001,4002]
  context-path: /v1
config:
  app:
    name: ComplexApp
  task:
    scheduling:
      pool:
        size: 7
  datasource:
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://1.2.3.4:3306/
    username: db_user_uat
    password: Password_uat_1234
    options: {&quot;prepStmtCacheSize&quot;:250,&quot;cachePrepStmts&quot;:true}
</pre></div></div>
</section><section>
<h2><a name="Rendering_Profiles"></a>Rendering Profiles</h2>
<p>This example is more about the flexibility of how and when the output files are rendered.</p>
<ul>

<li><b>Use case:</b> For this example we will assume a configuration driven application <code>TestApp</code> that runs in two environments <code>uat</code> and <code>prod</code>.</li>
</ul>
<p>The values present in the configurations for both these environments would be different and specific to the environment they are running in. Consider the following scenarios that may rise,</p>
<ol style="list-style-type: decimal">

<li>Rendering everything in one pass: When you want all outputs to be rendered at the same time. Like, rendering the configuration for all environments (<code>uat</code> and <code>prod</code>) at the same time.
<ol style="list-style-type: decimal">

<li>Rendering selectively by triggers: When you want to conditionally render selected outputs. Like, rendering when certain condition(s) are met.</li>
</ol>
</li>
</ol>
<p>For such scenarios, this plugin can be coupled with maven profiles to selectively render resources.</p>
<ul>

<li><b>Template File:</b></li>
</ul>
<p><code>/path/to/template/a_template.j2</code></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;app_name&quot;: &quot;{{name}}&quot;,
  &quot;app_version&quot;: {{version}},
  &quot;env_name&quot;: &quot;{{env}}&quot;,
  &quot;db_connect&quot;: &quot;{{db}}&quot;
}
</pre></div></div>

<ul>

<li><b>Value Files:</b></li>
</ul>
<p><code>/path/to/values/uat_values.json</code></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;name&quot;: &quot;SimpleApp&quot;,
  &quot;version&quot;: 1.0,
  &quot;env&quot;: &quot;uat&quot;,
  &quot;db_host&quot;: &quot;localhost&quot;,
  &quot;db_port&quot;: 1234,
  &quot;db&quot;: &quot;jdbc:mysql://{{db_host}}:{{db_port}}/&quot;
}
</pre></div></div>

<p><code>/path/to/values/prod_values.json</code></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;name&quot;: &quot;SimpleApp&quot;,
  &quot;version&quot;: 1.0,
  &quot;env&quot;: &quot;uat&quot;,
  &quot;db_host&quot;: &quot;1.2.3.4&quot;,
  &quot;db_port&quot;: 9876,
  &quot;db&quot;: &quot;jdbc:mysql://{{db_host}}:{{db_port}}/&quot;
}
</pre></div></div>

<ul>

<li><b>Plugin configuration:</b> The project&#x2019;s <code>pom.xml</code> can look something like below, with two different maven profiles <code>uat_build</code> and <code>prod_build</code>. They both use the same template, but the value file path and output file paths can be switched as per the activated profile.</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;project&gt;
    ...
    &lt;profiles&gt;
        ...
        &lt;profile&gt;
            &lt;!-- Profile for UAT Environment --&gt;
            &lt;id&gt;uat_build&lt;/id&gt;
            &lt;activation&gt;
                &lt;property&gt;
                    &lt;name&gt;uat_build&lt;/name&gt;
                &lt;/property&gt;
            &lt;/activation&gt;

            ...

            &lt;build&gt;
                &lt;plugins&gt;
                    ...
        
                    &lt;plugin&gt;
                        &lt;groupId&gt;com.github.chitralverma&lt;/groupId&gt;
                        &lt;artifactId&gt;jinja-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;${latest.plugin.version}&lt;/version&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;false&lt;/skip&gt;
                            &lt;failOnMissingValues&gt;true&lt;/failOnMissingValues&gt;
                            &lt;overwriteOutput&gt;false&lt;/overwriteOutput&gt;
                            &lt;resourceSet&gt;
                                &lt;resource&gt;
                                    &lt;templateFilePath&gt;/path/to/template/a_template.j2&lt;/templateFilePath&gt;
                                    &lt;valueFiles&gt;
                                        &lt;param&gt;/path/to/values/uat_values.json&lt;/param&gt;
                                    &lt;/valueFiles&gt;
                                    &lt;outputFilePath&gt;src/main/resources/jinja/results/uat_config.json&lt;/outputFilePath&gt;
                                &lt;/resource&gt;
                            &lt;/resourceSet&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;

                    ...
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;

        &lt;profile&gt;
            &lt;!-- Profile for PROD Environment --&gt;
            &lt;id&gt;prod_build&lt;/id&gt;
            &lt;activation&gt;
                &lt;property&gt;
                    &lt;name&gt;prod_build&lt;/name&gt;
                &lt;/property&gt;
            &lt;/activation&gt;

            ...

            &lt;build&gt;
                &lt;plugins&gt;
                    ...
        
                    &lt;plugin&gt;
                        &lt;groupId&gt;com.github.chitralverma&lt;/groupId&gt;
                        &lt;artifactId&gt;jinja-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;${latest.plugin.version}&lt;/version&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;false&lt;/skip&gt;
                            &lt;failOnMissingValues&gt;true&lt;/failOnMissingValues&gt;
                            &lt;overwriteOutput&gt;false&lt;/overwriteOutput&gt;
                            &lt;resourceSet&gt;
                                &lt;resource&gt;
                                    &lt;templateFilePath&gt;/path/to/template/a_template.j2&lt;/templateFilePath&gt;
                                    &lt;valueFiles&gt;
                                        &lt;param&gt;/path/to/values/prod_values.json&lt;/param&gt;
                                    &lt;/valueFiles&gt;
                                    &lt;outputFilePath&gt;src/main/resources/jinja/results/prod_config.json&lt;/outputFilePath&gt;
                                &lt;/resource&gt;
                            &lt;/resourceSet&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;

                    ...
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;

        ...
    &lt;/profiles&gt;

    ...
&lt;/project&gt;
</pre></div></div>

<ul>

<li>

<p><b>Execution:</b></p>
<ul>

<li>Going back to scenario (i) - Rendering everything in one pass - this can be achieved by either running the command below,</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint"># For UAT and PROD environment
mvn clean package -Duat_build -Dprod_build
</pre></div></div>

<p>or you can remove the separate maven profiles altogether and create two separate resource in the plugin directly, like below,</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;project&gt;
    ...

        &lt;build&gt;
            ...

            &lt;plugins&gt;
                ...

                &lt;plugin&gt;
                    &lt;groupId&gt;com.github.chitralverma&lt;/groupId&gt;
                    &lt;artifactId&gt;jinja-maven-plugin&lt;/artifactId&gt;
                    &lt;version&gt;${latest.plugin.version}&lt;/version&gt;
                    &lt;configuration&gt;
                        &lt;skip&gt;false&lt;/skip&gt;
                        &lt;failOnMissingValues&gt;true&lt;/failOnMissingValues&gt;
                        &lt;overwriteOutput&gt;false&lt;/overwriteOutput&gt;
                        &lt;resourceSet&gt;

                            &lt;!-- Profile for UAT Environment --&gt;
                            &lt;resource&gt;
                                &lt;templateFilePath&gt;/path/to/template/a_template.j2&lt;/templateFilePath&gt;
                                &lt;valueFiles&gt;
                                    &lt;param&gt;/path/to/values/uat_values.json&lt;/param&gt;
                                &lt;/valueFiles&gt;
                                &lt;outputFilePath&gt;src/main/resources/jinja/results/uat_config.json&lt;/outputFilePath&gt;
                            &lt;/resource&gt;

                            &lt;!-- Profile for PROD Environment --&gt;
                            &lt;resource&gt;
                                &lt;templateFilePath&gt;/path/to/template/a_template.j2&lt;/templateFilePath&gt;
                                &lt;valueFiles&gt;
                                    &lt;param&gt;/path/to/values/prod_values.json&lt;/param&gt;
                                &lt;/valueFiles&gt;
                                &lt;outputFilePath&gt;src/main/resources/jinja/results/prod_config.json&lt;/outputFilePath&gt;
                            &lt;/resource&gt;

                        &lt;/resourceSet&gt;
                    &lt;/configuration&gt;
                &lt;/plugin&gt;

                ...
            &lt;/plugins&gt;

            ...
        &lt;/build&gt;

    ...
&lt;/project&gt;
</pre></div></div>

<ul>

<li>As for the scenario (ii) - Rendering selectively by triggers - this can be achieved by running either of the below mentioned commands as per the requirement,</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint"># For UAT environment
mvn clean package -Duat_build

# For PROD environment
mvn clean package -Dprod_build
</pre></div></div>
</li>
<li>

<p><b>Output Files:</b></p>
</li>
</ul>
<p><code>src/main/resources/jinja/results/uat_config.json</code></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;app_name&quot;: &quot;SimpleApp&quot;,
  &quot;app_version&quot;: 1.0,
  &quot;env_name&quot;: &quot;uat&quot;,
  &quot;db_connect&quot;: &quot;jdbc:mysql://localhost:1234/&quot;
}
</pre></div></div>

<p><code>src/main/resources/jinja/results/prod_config.json</code></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
  &quot;app_name&quot;: &quot;SimpleApp&quot;,
  &quot;app_version&quot;: 1.0,
  &quot;env_name&quot;: &quot;uat&quot;,
  &quot;db_connect&quot;: &quot;jdbc:mysql://1.2.3.4:9876/&quot;
}
</pre></div></div></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<script type="text/javascript">
             $(document).ready(function () {
               var txt1 = "<p style='text-align:center'>Copyright © 2021 Chitral Verma. All rights reserved.</p>";
               $("body").append(txt1);
            });
            </script>
        </div>
      </div>
    </footer>
  </body>
</html>
